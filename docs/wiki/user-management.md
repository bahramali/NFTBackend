# کارهای مرتبط با ساخت و مدیریت کاربر در بک‌اند

این بخش توضیح می‌دهد بک‌اند هنگام ایجاد یا ویرایش کاربر چه کارهایی انجام می‌دهد و چطور می‌توانید از endpointها استفاده کنید.

## رفتار سرویس در ایجاد/ویرایش کاربر
- **کنترل یکتا بودن**: قبل از ذخیره، `UserService` بررسی می‌کند نام کاربری و ایمیل تکراری نباشد؛ در غیر این صورت خطای `400 Bad Request` برمی‌گرداند.
- **پاک‌سازی ورودی**: نام کاربری و ایمیل قبل از ذخیره trim می‌شوند تا فاصله‌های اضافی حذف شود.
- **نقش پیش‌فرض**: اگر نقش ارسال نشود یا `null` باشد، نقش `CUSTOMER` در نظر گرفته می‌شود.
- **مجوزها و وضعیت فعال**: مجموعه‌ی مجوزها به صورت Set ذخیره می‌شود و اگر مقدار `active` ارسال نشود، کاربر به صورت پیش‌فرض فعال است.
- **به‌روزرسانی ایمن**: در ویرایش، هر فیلد فقط در صورت ارسال مقدار جدید تغییر می‌کند و برای نام کاربری/ایمیل دوباره کنترل یکتا بودن انجام می‌شود. رمز عبور نمی‌تواند خالی باشد.

## Endpointهای مربوط به کاربر
- `POST /api/auth/login` برای دریافت توکن احراز هویت.
- `GET /api/users` و `GET /api/users/{id}` برای فهرست یا دریافت جزئیات کاربر.
- `POST /api/users` برای ایجاد کاربر جدید (با role و permissions اختیاری برای سطوح بالاتر).
- `PUT /api/users/{id}` برای ویرایش کاربر موجود.
- Endpointهای ویژه‌ی سوپر ادمین برای مدیریت ادمین‌ها:
  - `GET /api/super-admin/admins`
  - `POST /api/super-admin/admins`
  - `PUT /api/super-admin/admins/{id}`

> نکته: برای endpointهای ادمین/سوپرادمین، هدر `Authorization` را با توکن ورود ارسال کنید.

## کالکشن آماده برای Bruno
فایل [`postman/nft-backend.bru`](../../postman/nft-backend.bru) تمام endpointها (به‌همراه نمونه بدنه) را در قالب Bruno قرار می‌دهد. پیش از اجرا مقدار `baseUrl` و `authToken` را در محیط `local` به مقدار مناسب تغییر دهید.
