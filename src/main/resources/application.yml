server:
  forward-headers-strategy: framework

spring:
  jackson:
    deserialization:
      fail-on-unknown-properties: true

  application:
    name: NFTBackend

  mail:
    host: ${SPRING_MAIL_HOST:mailcluster.loopia.se}
    port: ${SPRING_MAIL_PORT:587}
    username: ${SPRING_MAIL_USERNAME:no-reply@hydroleaf.se}
    password: ${SPRING_MAIL_PASSWORD:}
    properties:
      mail:
        smtp:
          auth: ${SPRING_MAIL_SMTP_AUTH:true}
          starttls:
            enable: ${SPRING_MAIL_SMTP_STARTTLS_ENABLE:true}

  jpa:
    hibernate:
      ddl-auto: validate

  flyway:
    enabled: true
    locations: classpath:db/migration
    schemas: public
    default-schema: public
    table: flyway_schema_history
    validate-on-migrate: true

app:
  demo-seed:
    enabled: ${APP_DEMO_SEED_ENABLED:false}

  # ✅ FIX: This is where your backend code expects CORS config (prefix: app.cors)
  cors:
    allowed-origins:
      - https://hydroleaf.se
      - https://www.hydroleaf.se
      - https://bahramali.github.io
      - https://bahramali.github.io/NFTMonitoring
      - http://localhost:5173
      - http://localhost:5174

  # ✅ FIX: This is where your backend code expects OAuth config (prefix: app.oauth)
  oauth:
    frontend-base-url: ${APP_PUBLIC_URL:https://hydroleaf.se}
    allowed-redirect-uris:
      - https://hydroleaf.se
      - https://www.hydroleaf.se
      - http://localhost:5173
      - http://localhost:5174
      - https://bahramali.github.io/NFTMonitoring
    state-ttl: 10m
    rate-limit:
      capacity: 60
      refill-tokens: 60
      refill-seconds: 60
    google:
      client-id: ${GOOGLE_CLIENT_ID:}
      client-secret: ${GOOGLE_CLIENT_SECRET:}
      redirect-uri: ${GOOGLE_REDIRECT_URI:}
      authorization-endpoint: https://accounts.google.com/o/oauth2/v2/auth
      token-endpoint: https://oauth2.googleapis.com/token
      jwks-uri: https://www.googleapis.com/oauth2/v3/certs
      issuers:
        - https://accounts.google.com
        - accounts.google.com

  store:
    currency: SEK
    shipping-flat-cents: 0
    tax-rate-percent: 0
    fallback-payment-url: https://hydroleaf.se/store/pay/{orderId}
    nets-easy:
      api-base-url: ${NETS_EASY_API_BASE_URL:https://api.dibspayment.eu}
      secret-key: ${NETS_EASY_SECRET_KEY:}
      webhook-secret: ${NETS_EASY_WEBHOOK_SECRET:}
      success-url: ${NETS_EASY_SUCCESS_URL:https://hydroleaf.se/store/checkout/success?orderId={orderId}}
      cancel-url: ${NETS_EASY_CANCEL_URL:https://hydroleaf.se/store/checkout/cancel?orderId={orderId}}
    rate-limit:
      capacity: 120
      refill-tokens: 120
      refill-seconds: 60

  contact:
    rate-limit:
      per-minute:
        capacity: 5
        refill-tokens: 5
        refill-seconds: 60
      per-day:
        capacity: 20
        refill-tokens: 20
        refill-seconds: 86400
    turnstile:
      secret: ${APP_CONTACT_TURNSTILE_SECRET:}

  stripe:
    enabled: ${STRIPE_ENABLED:false}
    secret-key: ${STRIPE_SECRET_KEY:${STRIPE_API_KEY:}}
    webhook-secret: ${STRIPE_WEBHOOK_SECRET:}
    success-url: ${STRIPE_SUCCESS_URL:https://hydroleaf.se/store/order/%s/success}
    cancel-url: ${STRIPE_CANCEL_URL:https://hydroleaf.se/store/order/%s/cancel}

  invite-email:
    # single source of truth:
    smtp-enabled: ${APP_INVITE_EMAIL_SMTP_ENABLED:false}
    from: ${APP_INVITE_EMAIL_FROM:no-reply@hydroleaf.se}
    reply-to: ${APP_INVITE_EMAIL_REPLY_TO:}
    subject: ${APP_INVITE_EMAIL_SUBJECT:You have been invited to HydroLeaf}
    invite-link-template: ${APP_INVITE_LINK_TEMPLATE:}
  password-reset-email:
    smtp-enabled: ${APP_PASSWORD_RESET_EMAIL_SMTP_ENABLED:false}
    from: ${APP_PASSWORD_RESET_EMAIL_FROM:no-reply@hydroleaf.se}
    reply-to: ${APP_PASSWORD_RESET_EMAIL_REPLY_TO:}
    subject: ${APP_PASSWORD_RESET_EMAIL_SUBJECT:Reset your Hydroleaf password}
    reset-link-template: ${APP_PASSWORD_RESET_LINK_TEMPLATE:}
    public-base-url: ${APP_PASSWORD_RESET_PUBLIC_BASE_URL:${APP_PUBLIC_URL:https://hydroleaf.se}}
  contact-email:
    smtp-enabled: ${APP_CONTACT_EMAIL_SMTP_ENABLED:true}
    to: ${APP_CONTACT_EMAIL_TO:info@hydroleaf.se}
    from: ${APP_CONTACT_EMAIL_FROM:no-reply@hydroleaf.se}
    subject-prefix: ${APP_CONTACT_EMAIL_SUBJECT_PREFIX:[HydroLeaf Contact]}
  auth:
    jwt:
      secret: ${APP_JWT_SECRET:change-me-jwt-secret-change-me-jwt-secret}
      issuer: ${APP_JWT_ISSUER:hydroleaf-api}
      audience: ${APP_JWT_AUDIENCE:hydroleaf-app}
      access-token-ttl: 15m
    refresh:
      token-ttl: 30d
    cookie:
      name: ${APP_REFRESH_COOKIE_NAME:refreshToken}
      secure: ${APP_REFRESH_COOKIE_SECURE:true}
      http-only: true
      same-site: Strict
      path: /api/auth

# ✅ Keep this root stripe section ONLY for what your StripeProperties expects (prefix: stripe.*)
stripe:
  secret-key: ${STRIPE_SECRET_KEY:${STRIPE_API_KEY:}}
  allow-client-amount: ${STRIPE_ALLOW_CLIENT_AMOUNT:false}
