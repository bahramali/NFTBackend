# کارهای مرتبط با ساخت و مدیریت کاربر در بک‌اند

این بخش توضیح می‌دهد بک‌اند هنگام ایجاد یا ویرایش کاربر چه کارهایی انجام می‌دهد و چطور می‌توانید از endpointها استفاده کنید.

## رفتار سرویس در ایجاد/ویرایش کاربر
- **کنترل یکتا بودن ایمیل**: پیش از ذخیره، ایمیل trim و lowercase می‌شود و در صورت وجود ایمیل تکراری خطای `409 Conflict` برمی‌گردد.
- **حذف کامل نام کاربری**: ورود/مدیریت حساب صرفاً ایمیل‌محور است و فیلد `username` دیگر پذیرفته یا ذخیره نمی‌شود.
- **نقش الزامی در ساخت ادمین/کاربر مدیریتی**: در Endpointهای مدیریتی، نقش باید صراحتاً ارسال شود؛ مقادیر نامعتبر یا فقدان نقش باعث خطای `400 Bad Request` می‌شود.
- **مجوزها و وضعیت فعال**: مجوزها فقط برای نقش `ADMIN` اعمال می‌شوند و برای سایر نقش‌ها پاک می‌شوند؛ اگر مقدار `active` ارسال نشود کاربر به طور پیش‌فرض فعال است.
- **به‌روزرسانی ایمن**: هر فیلد فقط در صورت ارسال مقدار جدید تغییر می‌کند؛ تغییر ایمیل دوباره نرمال‌سازی و کنترل یکتا بودن را طی می‌کند و رمز عبور تنها در صورت مقدار غیرخالی جدید هش می‌شود.

## Endpointهای مربوط به کاربر
- `POST /api/auth/login` برای دریافت توکن احراز هویت.
- `GET /api/users` و `GET /api/users/{id}` برای فهرست یا دریافت جزئیات کاربر.
- `POST /api/users` برای ایجاد کاربر جدید (با role و permissions الزامی برای ادمین/سوپرادمین؛ کلاینت عمومی نمی‌تواند نقش را تعیین کند).
- `PUT /api/users/{id}` برای ویرایش کاربر موجود.
- Endpointهای ویژه‌ی سوپر ادمین برای مدیریت ادمین‌ها:
  - `GET /api/super-admin/admins`
  - `POST /api/super-admin/admins`
  - `PUT /api/super-admin/admins/{id}`

> نکته: برای endpointهای ادمین/سوپرادمین، هدر `Authorization` را با توکن ورود ارسال کنید.

## کالکشن آماده برای Bruno
فایل [`postman/nft-backend.bru`](../../postman/nft-backend.bru) تمام endpointها (به‌همراه نمونه بدنه) را در قالب Bruno قرار می‌دهد. پیش از اجرا مقدار `baseUrl` و `authToken` را در محیط `local` به مقدار مناسب تغییر دهید.
